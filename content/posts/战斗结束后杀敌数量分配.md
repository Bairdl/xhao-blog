---
date: '2025-10-26T14:31:38+08:00'
draft: true
title: '战斗结束后杀敌数量分配'
tags: []
categories: []
---

## 问题背景

战斗结束后，需要分配每个队列的击杀情况。

战斗分为攻击和防御两方。

每一方有多个队列，每个队列对应一支部队，包含 arm_id 和 arm_num （出发前的部队总数量），left_num（剩余的部队数量），weak_num 、injury_num 、dead_num （损失部队的详细划分，分为轻伤、重伤、死亡），以及 kill_list （击杀情况的列表）。kill_list 中是一个数组，包括多个元素。每个元素表示对某种敌方部分的击杀情况，包括 kill_arm_id 和 kill_arm_num 。

所以可以得到一个直接的约束就是，一方的损失情况，即对应 arm_id 的 arm_num-left_num 应该与敌方的 击杀情况符合。
比如攻击方的 arm_id 的 arm_num_left_num 应该等于防御方的所有队列中的 kill_arm_id 的 kill_arm_num 的和 （这里的 arm_id 和 kill_arm_id 是相同的）。

而现在的一个问题是，我们需要分配击杀情况，即将击杀情况也划分为轻伤、重伤和死亡。这就需要与分配后的结果与另一方的损失情况相对应。

补充信息：
每一方可能有多个玩家，所以应该是每一方有多个玩家，每个玩家有多个队列。每个队列有自身的损失情况和击杀情况。


### 原有解法

原有的解法中，只考虑了每个队列的总击杀数量，以及另一方的损伤情况（轻伤、重伤和死亡的数量）。

所以当前的解法是，对于每个队列的总击杀数量，仅仅对其按照比例进行分配。所有队列分配之后，计算分配后的详细击杀情况总数，然后调整任意队列的三种详细情况数量，来确保与另一方的损伤情况对应。

但是实际问题中，需要的根据击杀情况来计算积分，每种部队的积分不同，仅仅统计对部队造成的重伤和死亡数量，不统计轻伤。
在上面的解法中，仅仅只保证了击杀数量的三种详细情况总数与另一方的损伤情况对应，所以在实际积分计算中，会出现计算击杀积分与另一方的损失情况计算出来的积分不一致的情况。

### 新的解法

首先可以获取到双方，每种部队的损失情况，包括轻伤、重伤和死亡的数量。
然后可以拿到双方分别的对应击杀情况。主要包括对敌方部队的击杀情况，部队ID和击杀数量。

这样的话，可以直接统计对应敌方某种部队的损失情况，可以直接根据击杀比例分配其损失情况，最后微调部队的轻伤数量使其详细击杀情况符合部队的击杀数量。

比如攻击方有部队A和部队B，都对部队C造成了击杀，分别的击杀数量为KA和KB。防御方有部队C，损失情况轻伤、重伤和死亡数量分别为C1、C2和C3。

这样的话先计算出初始化分配情况。

``` txt
KSUM = KA + KB

A1 = C1 * (KA / KSUM)
A2 = C2 * (KA / KSUM)
A3 = C3 * (KA / KSUM)

B1 = C1 - A1
B2 = C2 - A2
B3 = C3 - A3
```

这样初步计算后，攻击方的每种部队对于部队C的详细击杀情况的总和，即轻伤、重伤和死亡数量，是与防御方部队C的损失情况一致的。

初步计算后的问题是，A1+A2+A3 != KA ，也就是每种部队的详细击杀情况的总和可能与击杀数量不一致。但是 A1+A2+A3+B1+B2+B3 = KA+KB = C1+C2+C3， 也就是总和击杀情况与总和损失情况是一致的。

这样的话，我们可以微调A1和B1的数量，即只微调轻伤的数量，使每种部队的详细击杀情况与击杀数量一致。

--- 

算法优化

首先积分的计算是基于玩家的。
所以对于同一玩家的不同队列之间对于同一敌方部队的击杀情况，并不需要详细划分，只需要直接将敌方对应部队的损失情况作为总的击杀情况即可。

对于不同玩家之前的队列，可以首先按玩家分组来统计对同一敌方部队的击杀数量总和，然后按照击杀数量的比例分配敌方对应部队的损失情况来作为玩家的详细击杀情况。

缺点是由于小数部分截取，所以后分配的玩家会有更多的积分。