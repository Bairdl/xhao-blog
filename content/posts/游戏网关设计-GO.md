+++
date = '2025-09-15T22:32:30+08:00'
draft = false
title = '游戏网关设计 GO'
mermaid = true
+++

# 游戏网关设计

## 目标

负责处理游戏客户端与服务端之间传递的消息。

1. 消息转发：负责客户端请求和服务端响应的转发。
2. 向客户端推送服务端广播的消息。
3. 维护当前网关活跃的玩家列表，缓存一定时间内的离线消息。
4. 要有高扩展性，可以方便地在网关上添加部分业务逻辑。（例如将地图隶属的逻辑在网关部分处理。）
5. 与当前Go服务兼容，使用当前Go服务端的服务结构，以Go服务端的一个服务运行。
6. 统计所需数据。

## 设计

### 当前设计

- 使用 Player 维护玩家信息，包括离线消息等。使用 PlayerManager 维护当前网关活跃玩家列表，定期清理不活跃的玩家信息。  
- 使用 Session 维护游戏客户端与网关之间的 Tcp 连接，负责接受来自游戏客户端的消息，并将其封装后以 HTTP 请求形式发送给服务端，接收到 HTTP 响应后，转换数据使用 Tcp 连接发送回游戏客户端，并更新 Player 状态（最新活跃时间等）。如果是检查登录等消息，还需要更新 Player 与 Session 的映射关系。  
- 使用 SessionManager 维护当前网关活跃的 Session 列表。  
- 使用 Tcp 监听服务，接受新的客户端连接请求，并通知 SessionManager 创建新的 Session 进行管理。  
- 使用 HTTP 监听服务，处理指定路由并使用Post格式的请求。服务端会通过使用指定方式向指定路由发送 HTTP 请求的形式主动要求网关向游戏客户端推送数据。  

当前的设计中，各个模块之前使用管道进行通信。
序列图。

``` mermaid
graph TD
    A[开始] --> B[处理]
    B --> C[结束]
```
