---
date: '2025-09-18T23:51:05+08:00'
draft: false
title: '懒删除堆'
categories: ['算法']
tags: ['数据结构', '算法']
---

# 懒删除堆

懒删除堆定义
懒删除堆是一种支持 **延迟删除操作** 的堆数据结构。它在标准堆的基础上，通过延迟实际删除来优化删除操作的性能。

## 核心思想

- 延迟删除：当需要删元素时，并不立即将其从堆中移除，而是先标记为“已删除”。实际删除操作延迟到必需的时候进行（如访问堆顶元素）。
- 空间换时间：通过暂存删除元素，减少调整堆结构的开销，从而提升效率。（适合需要频繁删除元素的场景）

## 工作原理

1. 数据结构：
   1. 一个主堆（如最大堆或者最小堆），用于存储元素（包括未删除的和标记为删除的）。
   2. 一个辅助数据结构（如哈希表或者另一个堆），用于存储标记删除的元素及其计数（避免重复标记的问题）。
2. 操作：
   1. 插入：直接向堆中插入元素。
   2. 删除：当需要删除元素时，更新删除记录。
   3. 访问堆顶：
      1. 检查堆顶元素是否有效（是否已被标记为删除元素）。
      2. 如果堆顶元素无效，则弹出堆顶并重复该过程，直到堆顶是有效元素。
      3. 如果堆顶元素有效，则直接返回。

## 优缺点

### 优点

- 减少调整开销：避免每次删除都调整堆结构，将多次调整操作合并到后续查询操作中。
- 适合频繁删除：在删除操作密集的情况下，性能较好。

### 缺点

- 空间占用：数据结构中会缓存大量的无用数据。
- 可能退化：在访问堆顶元素时，可能需要处理多个删除标记。

## 应用场景

适用于 频繁删除非堆顶元素的优先级队列。

---

## Go 中的堆和懒删除堆

go 中的堆主要通过实现 `container/heap` 接口中的函数来实现。  
包中已经提供堆的调整算法，只需要实现一些函数即可。  
示例

``` go
// This example demonstrates an integer heap built using the heap interface.
package main

import (
	"container/heap"
	"fmt"
)

// An IntHeap is a min-heap of ints.
type IntHeap []int

func (h IntHeap) Len() int           { return len(h) }
func (h IntHeap) Less(i, j int) bool { return h[i] < h[j] }
func (h IntHeap) Swap(i, j int)      { h[i], h[j] = h[j], h[i] }

func (h *IntHeap) Push(x any) {
	// Push and Pop use pointer receivers because they modify the slice's length,
	// not just its contents.
	*h = append(*h, x.(int))
}

func (h *IntHeap) Pop() any {
	old := *h
	n := len(old)
	x := old[n-1]
	*h = old[0 : n-1]
	return x
}

// This example inserts several ints into an IntHeap, checks the minimum,
// and removes them in order of priority.
func main() {
	h := &IntHeap{2, 1, 5}
	heap.Init(h)
	heap.Push(h, 3)
	fmt.Printf("minimum: %d\n", (*h)[0])
	for h.Len() > 0 {
		fmt.Printf("%d ", heap.Pop(h))
	}
}
```
